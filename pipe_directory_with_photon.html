
<!DOCTYPE html>
<html>
<head>
  <title>PipeDirectoryMp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
    .toolbar {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      border-radius: 5px;
      z-index: 1001;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .toolbar button {
      cursor: pointer;
      padding: 5px 10px;
    }
    .form-popup {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 1000;
      display: none;
    }
    input, select, textarea { width: 100%; margin: 5px 0; padding: 5px; }
  </style>
</head>
<body>
  <div class="toolbar">
    <button id="panTool">üñêÔ∏è Pan</button>
    <button id="pinTool">‚ûï Add Pin</button>
    <input type="text" id="searchBox" placeholder="Search location...">
    <button id="searchButton">üîç</button>
  </div>
  <div id="map"></div>
  <div class="form-popup" id="formPopup">
    <h4>Pipe Segment Info</h4>
    <form id="pipeForm">
      <input type="text" placeholder="Footage (ft)" id="footage">
      <input type="text" placeholder="Pipe Size" id="pipeSize">
      <input type="text" placeholder="Lot Number" id="lotNumber">
      <select id="method">
        <option value="Trench">Trench</option>
        <option value="Bore">Bore</option>
      </select>
      <input type="text" placeholder="Tracer Wire Size" id="wireSize">
      <textarea placeholder="Notes" id="notes"></textarea>
      <input type="file" id="media" multiple accept="image/*,video/*">
      <button type="submit">Save Entry</button>
      <button type="button" onclick="document.getElementById('formPopup').style.display='none'">Close</button>
    </form>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <script>
    L.Control.Geocoder.photon = function (options) {
      return new L.Control.Geocoder({
        geocode: function (query, cb) {
          fetch("https://photon.komoot.io/api/?q=" + encodeURIComponent(query))
            .then(res => res.json())
            .then(data => {
              const results = data.features.map(feature => {
                const center = L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]);
                return {
                  name: feature.properties.name || query,
                  center,
                  bbox: feature.bbox
                };
              });
              cb(results);
            });
        }
      });
    };

    const map = L.map('map').setView([30.4, -89.0], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 20 }).addTo(map);
    const geocoder = L.Control.Geocoder.photon();

    document.getElementById('searchButton').addEventListener('click', function () {
      const query = document.getElementById('searchBox').value;
      geocoder.geocode(query, function (results) {
        if (results.length > 0) {
          const r = results[0];
          map.setView(r.center, 16);
          L.marker(r.center).addTo(map).bindPopup(r.name).openPopup();
        } else {
          alert('Location not found');
        }
      });
    });
  </script>
</body>
</html>
